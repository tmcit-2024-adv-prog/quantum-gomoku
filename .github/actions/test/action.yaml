name: test

runs:
  using: composite
  steps:
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        java-version: "21"
        distribution: "corretto"

    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@v4

    - name: Test
      run: ./gradlew jacocoTestReport
      continue-on-error: true

    - name: Test dev
      run: ./gradlew jacocoTestReport -Penv=dev
      continue-on-error: true

    - name: Report test results
      uses: mikepenz/action-junit-report@v4
      with:
        report_paths: "**/build/test-results/test/TEST-*.xml"

    - name: Jacoco Report
      uses: madrapps/jacoco-report@v1.7.1
      with:
        paths: ${{ github.workspace }}/**/build/reports/jacoco/**/jacocoTestReport.xml
        token: ${{ secrets.GITHUB_TOKEN }}
